<% unless @post.new_record? %>
  <% content_for :content_title, @post.title %>
  <% content_for :content_subtitle, @blog.title %>
  <% content_for :content_title_extra do %>
    <%= page_header_buttons do %>
      <%= present(@post).label_published %>
      <%= link_to(icon_label(:view, 'View'), post_show_url(@blog, @post), class: "btn btn-xs btn-default", title: 'View', target: '_blank') %>
      <div class="btn-group">
        <button class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown"><%= icons(:gear) %> <span class="caret"></span></button>
        <ul class="dropdown-menu dropdown-menu-right icons-right">
          <% if @post.notification_sent_on.nil? %>
            <li><%= link_to 'Send Notification Emails', send_notifications_emails_admin_cms_post_path(@post), method: :put, data: {confirm: 'This will send a post notification email to each user of this blog.  Are you sure?'} %></li>
          <% else %>
            <li><%= link_to 'Re-Send Notification Emails', send_notifications_emails_admin_cms_post_path(@post), method: :put, data: {confirm: "WARNING: An email was already sent on #{format_datetime(@post.notification_sent_on)}.  Are you sure you want to send another?"} %></li>
          <% end %>
          <li><%= link_to 'Send Test Email', send_notifications_emails_admin_cms_post_path(@post, test: true), method: :put, data: {confirm: 'This will send a test post notification email to your email account.  Are you sure?'} %></li>
          <li><%= link_to 'Clear Facebook Cache', "https://developers.facebook.com/tools/debug/og/object?q=#{ERB::Util.url_encode(dm_cms.post_show_url(@post.cms_blog.slug, @post.slug))}", target: '_blank' %></li>            
        </ul>
      </div>
    <% end %>
  <% end %>
<% else %>
  <% content_for :content_title, @blog.title %>
<% end %>

<% submit_url = (@post.new_record? ? admin_cms_blog_cms_posts_path(@blog) : admin_cms_post_path) %>
<%= simple_form_for @post, url: submit_url,
    html: { class: 'form-horizontal' }, wrapper: :bs3_horizontal_form, wrapper_mappings: DmAdmin::FormWrapperMappings do |f| %>

  <%= f.error_notification message: "Please review the problems below" %>
  <% toolbar = capture do %>
    <%= link_to icons(:help), '#', class: 'btn btn-link btn-icon', data: { toggle: 'modal', target: '#tag_reference' } %>
    <%= link_to icons(:cancel), admin_cms_blog_path(@blog), class: 'btn btn-link btn-icon' %>
  <% end %>
  <%= panel toolbar: toolbar do %>
    <div class="form-group string required">
      <label class="string required col-sm-2 control-label" for="post_starting_on">
        <abbr title="required">*</abbr> Publish on
      </label>
      <div class="col-sm-10">
        <div class="row">
          <div class="col-sm-6">
            <input name="cms_post[published_on_date]" type="text" value="<%= @post.published_on.to_date unless @post.published_on.nil? %>" placeholder="Select date..." id="date1" class="datepicker time" >
          </div>
          <div class="col-sm-6">
            <input name="cms_post[published_on_time]" type="text" class="time_select" value="<%= @post.published_on.strftime("%I:%M%p") unless @post.published_on.nil? %>" placeholder="Select time..." />
          </div>
        </div>
        <div class="clearfix"></div>
        <p class="help-block">Leave blank for DRAFT mode</p>
      </div>
      <div class="clearfix"></div>
    </div>

    <%= locale_tabs do |locale| %>
      <%= f.input "title_#{locale}",   label: 'Post Title', required: true %>
      <%= f.input "summary_#{locale}", label: 'Summary',    required: true, wrapper: :bs3_vertical_form, as: :code_editor, input_html: {style: "height: 100px;"} %>
      <%= f.input "content_#{locale}", label: 'Content',    required: true, wrapper: :bs3_vertical_form, as: :code_editor, input_html: {style: "height: 500px;"} %>
    <% end %>

    <%= f.input :slug, label: 'Slug', hint: 'Leave blank to have auto-generated based on title.' %>
    <%= f.input :featured_image, label: 'Featured Image', id: 'image_error' %>
    <%= f.input :comments_allowed, as: :boolean, label: 'Allow Comments', hint: 'Turn on if you want commenting for this post.' %>

    <%= submit_or_cancel cancel_url: admin_cms_blog_path(@blog), delete_url: ([:admin, @post] unless @post.new_record?), delete_confirm: 'Are you sure you wish to delete this post?  All comments will also be deleted!' %>

  <% end %>
<% end %>

<%= render partial: 'dm_cms/admin/shared/liquid_tags_ref' %>
